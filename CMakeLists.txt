cmake_minimum_required(VERSION 3.10)

project(felis)

find_package(Doxygen)
if (DOXYGEN_FOUND)
  message(STATUS "Doxygen Found.")

  # Search for plantUML for creating UML diagrams from doxygen
  find_program(PLANT_UML_PATH plantuml.jar PATH_SUFFIXES PlantUML plantuml Plantuml 
    PATHS /usr/share /usr/local/share/ /usr/local/bin)
  if(NOT PLANT_UML_PATH)
    message(WARNING "Looking for PlantUML - not found, some UML diagrams will not be generated via doxygen.")
  else()
    message(STATUS "  + PlantUML - for custom UML             YES ")
  endif()

  #Search for DOT for autogenerated UML diagrams from doxygen
  find_program(DOT_PATH dot PATH_SUFFIXES graphviz2.38/bin graphviz/bin)
  if(NOT DOT_PATH)
    message(WARNING "Looking for DOT (Graphviz) - not found, some UML diagrams will not be generated via doxygen.")
  else()
    message(STATUS "  + Graphviz/Dot - for generated graphs   YES ")
  endif()

  # configure doxygen configuration file
  set(doxyfile_in ${CMAKE_CURRENT_SOURCE_DIR}/doxygen/Doxyfile.in)
  set(doxyfile ${CMAKE_CURRENT_BINARY_DIR}/Doxyfile)
  configure_file(${doxyfile_in} ${doxyfile} @ONLY)

  add_custom_target(doxygen
    COMMAND ${DOXYGEN_EXECUTABLE} ${doxyfile}
    WORKING_DIRECTORY ${PROJECT_SOURCE_DIR}
    COMMENT "Generating API documentation with Doxygen"
    VERBATIM)

else()
  message(ERROR "Doxygen not Found.")

endif()
